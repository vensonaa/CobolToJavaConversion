       IDENTIFICATION DIVISION.
       PROGRAM-ID. MAIN-SYSTEM.
       AUTHOR. ENTERPRISE-DEVELOPER.
       DATE-WRITTEN. 2024-12-19.
       DATE-COMPILED. 2024-12-19.
       SECURITY. CONFIDENTIAL.
       
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SOURCE-COMPUTER. IBM-3090.
       OBJECT-COMPUTER. IBM-3090.
       SPECIAL-NAMES.
           CURRENCY SIGN IS "$".
       
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT SYSTEM-CONFIG ASSIGN TO 'system_config.dat'
                  ORGANIZATION IS INDEXED
                  ACCESS MODE IS RANDOM
                  RECORD KEY IS CONFIG-KEY
                  FILE STATUS IS WS-CONFIG-STATUS.
           
           SELECT USER-SESSION ASSIGN TO 'user_sessions.dat'
                  ORGANIZATION IS INDEXED
                  ACCESS MODE IS RANDOM
                  RECORD KEY IS SESSION-KEY
                  FILE STATUS IS WS-SESSION-STATUS.
           
           SELECT AUDIT-LOG ASSIGN TO 'audit_log.dat'
                  ORGANIZATION IS SEQUENTIAL
                  ACCESS MODE IS SEQUENTIAL
                  FILE STATUS IS WS-AUDIT-STATUS.
           
           SELECT ERROR-LOG ASSIGN TO 'error_log.dat'
                  ORGANIZATION IS SEQUENTIAL
                  ACCESS MODE IS SEQUENTIAL
                  FILE STATUS IS WS-ERROR-STATUS.
       
       DATA DIVISION.
       FILE SECTION.
       FD  SYSTEM-CONFIG.
       01  CONFIG-RECORD.
           05  CONFIG-KEY           PIC X(20).
           05  CONFIG-VALUE         PIC X(100).
           05  CONFIG-DESCRIPTION   PIC X(200).
           05  CONFIG-LAST-UPDATE   PIC 9(8).
           05  CONFIG-UPDATED-BY    PIC X(20).
       
       FD  USER-SESSION.
       01  SESSION-RECORD.
           05  SESSION-KEY          PIC X(20).
           05  SESSION-USER-ID      PIC X(20).
           05  SESSION-START-TIME   PIC 9(14).
           05  SESSION-LAST-ACTIVITY PIC 9(14).
           05  SESSION-STATUS       PIC X(1).
               88  SESSION-ACTIVE   VALUE 'A'.
               88  SESSION-TIMEOUT  VALUE 'T'.
               88  SESSION-LOGOUT   VALUE 'L'.
           05  SESSION-MODULE       PIC X(30).
           05  SESSION-PERMISSIONS  PIC X(100).
       
       FD  AUDIT-LOG.
       01  AUDIT-RECORD.
           05  AUDIT-TIMESTAMP      PIC 9(14).
           05  AUDIT-USER-ID        PIC X(20).
           05  AUDIT-MODULE         PIC X(30).
           05  AUDIT-ACTION         PIC X(20).
           05  AUDIT-DETAILS        PIC X(200).
           05  AUDIT-IP-ADDRESS     PIC X(15).
           05  AUDIT-SESSION-ID     PIC X(20).
       
       FD  ERROR-LOG.
       01  ERROR-RECORD.
           05  ERROR-TIMESTAMP      PIC 9(14).
           05  ERROR-LEVEL          PIC X(1).
               88  ERROR-INFO       VALUE 'I'.
               88  ERROR-WARNING    VALUE 'W'.
               88  ERROR-ERROR      VALUE 'E'.
               88  ERROR-FATAL      VALUE 'F'.
           05  ERROR-MODULE         PIC X(30).
           05  ERROR-CODE           PIC X(10).
           05  ERROR-MESSAGE        PIC X(200).
           05  ERROR-STACK-TRACE    PIC X(500).
           05  ERROR-USER-ID        PIC X(20).
       
       WORKING-STORAGE SECTION.
       01  WS-SYSTEM-CONSTANTS.
           05  WS-MAX-USERS         PIC 9(4) VALUE 1000.
           05  WS-MAX-SESSIONS      PIC 9(4) VALUE 500.
           05  WS-SESSION-TIMEOUT   PIC 9(6) VALUE 1800.
           05  WS-MAX-LOGIN-ATTEMPTS PIC 9(2) VALUE 3.
           05  WS-PASSWORD-EXPIRY   PIC 9(4) VALUE 90.
       
       01  WS-SYSTEM-VARIABLES.
           05  WS-CURRENT-DATE      PIC 9(8).
           05  WS-CURRENT-TIME      PIC 9(6).
           05  WS-CURRENT-TIMESTAMP PIC 9(14).
           05  WS-USER-ID           PIC X(20).
           05  WS-SESSION-ID        PIC X(20).
           05  WS-MODULE-NAME       PIC X(30).
           05  WS-PROGRAM-STATUS    PIC X(1).
               88  WS-STATUS-NORMAL VALUE 'N'.
               88  WS-STATUS-ERROR  VALUE 'E'.
               88  WS-STATUS-WARNING VALUE 'W'.
           05  WS-TRANSACTION-COUNT PIC 9(6).
           05  WS-ERROR-COUNT       PIC 9(4).
       
       01  WS-USER-AUTHENTICATION.
           05  WS-LOGIN-ATTEMPTS    PIC 9(2).
           05  WS-LAST-LOGIN-DATE   PIC 9(8).
           05  WS-PASSWORD-CHANGE-DATE PIC 9(8).
           05  WS-USER-STATUS       PIC X(1).
               88  WS-USER-ACTIVE   VALUE 'A'.
               88  WS-USER-LOCKED   VALUE 'L'.
               88  WS-USER-EXPIRED  VALUE 'E'.
           05  WS-USER-ROLE         PIC X(20).
           05  WS-USER-PERMISSIONS  PIC X(100).
       
       01  WS-MENU-STRUCTURE.
           05  WS-MAIN-MENU.
               10  WS-MENU-OPTION-1 PIC X(30) VALUE '1. PRODUCT MANAGEMENT'.
               10  WS-MENU-OPTION-2 PIC X(30) VALUE '2. INVENTORY CONTROL'.
               10  WS-MENU-OPTION-3 PIC X(30) VALUE '3. SUPPLIER MANAGEMENT'.
               10  WS-MENU-OPTION-4 PIC X(30) VALUE '4. CUSTOMER MANAGEMENT'.
               10  WS-MENU-OPTION-5 PIC X(30) VALUE '5. PURCHASE ORDERS'.
               10  WS-MENU-OPTION-6 PIC X(30) VALUE '6. SALES ORDERS'.
               10  WS-MENU-OPTION-7 PIC X(30) VALUE '7. WAREHOUSE MANAGEMENT'.
               10  WS-MENU-OPTION-8 PIC X(30) VALUE '8. REPORTING SYSTEM'.
               10  WS-MENU-OPTION-9 PIC X(30) VALUE '9. SYSTEM ADMINISTRATION'.
               10  WS-MENU-OPTION-0 PIC X(30) VALUE '0. EXIT SYSTEM'.
           05  WS-MENU-CHOICE       PIC 9(1).
       
       01  WS-MODULE-CALLS.
           05  WS-CALL-PRODUCT-MGMT PIC X(8) VALUE 'PROD-MGT'.
           05  WS-CALL-INVENTORY    PIC X(8) VALUE 'INV-CTRL'.
           05  WS-CALL-SUPPLIER     PIC X(8) VALUE 'SUPP-MGT'.
           05  WS-CALL-CUSTOMER     PIC X(8) VALUE 'CUST-MGT'.
           05  WS-CALL-PURCHASE     PIC X(8) VALUE 'PUR-ORD'.
           05  WS-CALL-SALES        PIC X(8) VALUE 'SALES-ORD'.
           05  WS-CALL-WAREHOUSE    PIC X(8) VALUE 'WH-MGT'.
           05  WS-CALL-REPORTS      PIC X(8) VALUE 'REPORTS'.
           05  WS-CALL-ADMIN        PIC X(8) VALUE 'SYS-ADMIN'.
       
       01  WS-FILE-STATUS-VARIABLES.
           05  WS-CONFIG-STATUS     PIC X(2).
           05  WS-SESSION-STATUS    PIC X(2).
           05  WS-AUDIT-STATUS      PIC X(2).
           05  WS-ERROR-STATUS      PIC X(2).
       
       01  WS-ERROR-HANDLING.
           05  WS-ERROR-CODE        PIC X(4).
           05  WS-ERROR-MESSAGE     PIC X(100).
           05  WS-ERROR-SEVERITY    PIC X(1).
           05  WS-ERROR-LOCATION    PIC X(50).
       
       01  WS-SYSTEM-MESSAGES.
           05  WS-MSG-WELCOME       PIC X(50) VALUE 'WELCOME TO ENTERPRISE INVENTORY SYSTEM'.
           05  WS-MSG-LOGIN-PROMPT  PIC X(30) VALUE 'PLEASE ENTER YOUR USER ID:'.
           05  WS-MSG-PASSWORD-PROMPT PIC X(30) VALUE 'PLEASE ENTER PASSWORD:'.
           05  WS-MSG-LOGIN-SUCCESS PIC X(30) VALUE 'LOGIN SUCCESSFUL'.
           05  WS-MSG-LOGIN-FAILED  PIC X(30) VALUE 'LOGIN FAILED - INVALID CREDENTIALS'.
           05  WS-MSG-ACCOUNT-LOCKED PIC X(30) VALUE 'ACCOUNT LOCKED - CONTACT ADMIN'.
           05  WS-MSG-SESSION-TIMEOUT PIC X(30) VALUE 'SESSION TIMEOUT - PLEASE LOGIN AGAIN'.
           05  WS-MSG-LOGOUT-SUCCESS PIC X(30) VALUE 'LOGOUT SUCCESSFUL'.
           05  WS-MSG-SYSTEM-EXIT   PIC X(30) VALUE 'SYSTEM SHUTDOWN COMPLETE'.
       
       PROCEDURE DIVISION.
       
       0000-MAIN-PROCEDURE.
           PERFORM 1000-SYSTEM-INITIALIZATION
           PERFORM 2000-USER-AUTHENTICATION
           IF WS-USER-STATUS = 'A'
               PERFORM 3000-MAIN-MENU-LOOP
           END-IF
           PERFORM 9000-SYSTEM-CLEANUP
           STOP RUN.
       
       1000-SYSTEM-INITIALIZATION.
           MOVE FUNCTION CURRENT-DATE TO WS-CURRENT-TIMESTAMP
           MOVE WS-CURRENT-TIMESTAMP(1:8) TO WS-CURRENT-DATE
           MOVE WS-CURRENT-TIMESTAMP(9:6) TO WS-CURRENT-TIME
           PERFORM 1100-OPEN-SYSTEM-FILES
           PERFORM 1200-LOAD-SYSTEM-CONFIGURATION
           PERFORM 1300-INITIALIZE-SYSTEM-VARIABLES
           PERFORM 1400-DISPLAY-SYSTEM-BANNER.
       
       1100-OPEN-SYSTEM-FILES.
           OPEN INPUT SYSTEM-CONFIG
           IF WS-CONFIG-STATUS NOT = '00'
               PERFORM 9999-SYSTEM-ERROR
           END-IF
           OPEN EXTEND AUDIT-LOG
           IF WS-AUDIT-STATUS NOT = '00'
               PERFORM 9999-SYSTEM-ERROR
           END-IF
           OPEN EXTEND ERROR-LOG
           IF WS-ERROR-STATUS NOT = '00'
               PERFORM 9999-SYSTEM-ERROR
           END-IF
           OPEN I-O USER-SESSION
           IF WS-SESSION-STATUS NOT = '00' AND '05'
               PERFORM 9999-SYSTEM-ERROR
           END-IF.
       
       1200-LOAD-SYSTEM-CONFIGURATION.
           MOVE 'SYSTEM_VERSION' TO CONFIG-KEY
           READ SYSTEM-CONFIG
           IF WS-CONFIG-STATUS = '00'
               MOVE CONFIG-VALUE TO WS-SYSTEM-VERSION
           END-IF
           MOVE 'SESSION_TIMEOUT' TO CONFIG-KEY
           READ SYSTEM-CONFIG
           IF WS-CONFIG-STATUS = '00'
               MOVE CONFIG-VALUE TO WS-SESSION-TIMEOUT
           END-IF.
       
       1300-INITIALIZE-SYSTEM-VARIABLES.
           MOVE 'N' TO WS-PROGRAM-STATUS
           MOVE 0 TO WS-TRANSACTION-COUNT
           MOVE 0 TO WS-ERROR-COUNT
           MOVE SPACES TO WS-USER-ID
           MOVE SPACES TO WS-SESSION-ID
           MOVE SPACES TO WS-MODULE-NAME.
       
       1400-DISPLAY-SYSTEM-BANNER.
           DISPLAY WS-MSG-WELCOME
           DISPLAY 'SYSTEM VERSION: ' WS-SYSTEM-VERSION
           DISPLAY 'CURRENT DATE: ' WS-CURRENT-DATE
           DISPLAY 'CURRENT TIME: ' WS-CURRENT-TIME
           DISPLAY SPACE.
       
       2000-USER-AUTHENTICATION.
           PERFORM 2100-DISPLAY-LOGIN-SCREEN
           PERFORM 2200-GET-USER-CREDENTIALS
           PERFORM 2300-VALIDATE-USER-CREDENTIALS
           IF WS-USER-STATUS = 'A'
               PERFORM 2400-CREATE-USER-SESSION
               PERFORM 2500-LOG-SUCCESSFUL-LOGIN
           ELSE
               PERFORM 2600-HANDLE-LOGIN-FAILURE
           END-IF.
       
       2100-DISPLAY-LOGIN-SCREEN.
           DISPLAY '========================================'
           DISPLAY '        ENTERPRISE INVENTORY SYSTEM'
           DISPLAY '========================================'
           DISPLAY SPACE.
       
       2200-GET-USER-CREDENTIALS.
           DISPLAY WS-MSG-LOGIN-PROMPT
           ACCEPT WS-USER-ID
           DISPLAY WS-MSG-PASSWORD-PROMPT
           ACCEPT WS-PASSWORD
           MOVE FUNCTION CURRENT-DATE TO WS-CURRENT-TIMESTAMP.
       
       2300-VALIDATE-USER-CREDENTIALS.
           PERFORM 2310-CHECK-USER-EXISTS
           IF WS-USER-STATUS = 'A'
               PERFORM 2320-VALIDATE-PASSWORD
               IF WS-PASSWORD-VALID
                   PERFORM 2330-CHECK-ACCOUNT-STATUS
               END-IF
           END-IF.
       
       2310-CHECK-USER-EXISTS.
           MOVE 'USER_NOT_FOUND' TO WS-ERROR-CODE
           MOVE 'USER ID NOT FOUND IN SYSTEM' TO WS-ERROR-MESSAGE
           MOVE 'E' TO WS-ERROR-SEVERITY
           MOVE 'USER-AUTHENTICATION' TO WS-ERROR-LOCATION
           PERFORM 9998-LOG-ERROR.
       
       2320-VALIDATE-PASSWORD.
           MOVE 'INVALID_PASSWORD' TO WS-ERROR-CODE
           MOVE 'PASSWORD VALIDATION FAILED' TO WS-ERROR-MESSAGE
           MOVE 'E' TO WS-ERROR-SEVERITY
           MOVE 'PASSWORD-VALIDATION' TO WS-ERROR-LOCATION
           PERFORM 9998-LOG-ERROR.
       
       2330-CHECK-ACCOUNT-STATUS.
           MOVE 'ACCOUNT_LOCKED' TO WS-ERROR-CODE
           MOVE 'USER ACCOUNT IS LOCKED' TO WS-ERROR-MESSAGE
           MOVE 'E' TO WS-ERROR-SEVERITY
           MOVE 'ACCOUNT-STATUS-CHECK' TO WS-ERROR-LOCATION
           PERFORM 9998-LOG-ERROR.
       
       2400-CREATE-USER-SESSION.
           MOVE FUNCTION CURRENT-DATE TO WS-CURRENT-TIMESTAMP
           MOVE WS-CURRENT-TIMESTAMP TO SESSION-START-TIME
           MOVE WS-CURRENT-TIMESTAMP TO SESSION-LAST-ACTIVITY
           MOVE 'A' TO SESSION-STATUS
           MOVE WS-USER-ID TO SESSION-USER-ID
           MOVE 'MAIN-SYSTEM' TO SESSION-MODULE
           MOVE WS-USER-PERMISSIONS TO SESSION-PERMISSIONS
           WRITE SESSION-RECORD
           IF WS-SESSION-STATUS = '00'
               MOVE SESSION-KEY TO WS-SESSION-ID
           END-IF.
       
       2500-LOG-SUCCESSFUL-LOGIN.
           MOVE FUNCTION CURRENT-DATE TO AUDIT-TIMESTAMP
           MOVE WS-USER-ID TO AUDIT-USER-ID
           MOVE 'MAIN-SYSTEM' TO AUDIT-MODULE
           MOVE 'LOGIN' TO AUDIT-ACTION
           MOVE 'SUCCESSFUL LOGIN' TO AUDIT-DETAILS
           MOVE '192.168.1.100' TO AUDIT-IP-ADDRESS
           MOVE WS-SESSION-ID TO AUDIT-SESSION-ID
           WRITE AUDIT-RECORD.
       
       2600-HANDLE-LOGIN-FAILURE.
           DISPLAY WS-MSG-LOGIN-FAILED
           DISPLAY WS-ERROR-MESSAGE
           PERFORM 9998-LOG-ERROR.
       
       3000-MAIN-MENU-LOOP.
           PERFORM 3100-DISPLAY-MAIN-MENU
           PERFORM 3200-GET-MENU-CHOICE
           PERFORM 3300-PROCESS-MENU-CHOICE
           UNTIL WS-MENU-CHOICE = 0.
       
       3100-DISPLAY-MAIN-MENU.
           DISPLAY SPACE
           DISPLAY '========================================'
           DISPLAY '              MAIN MENU'
           DISPLAY '========================================'
           DISPLAY WS-MENU-OPTION-1
           DISPLAY WS-MENU-OPTION-2
           DISPLAY WS-MENU-OPTION-3
           DISPLAY WS-MENU-OPTION-4
           DISPLAY WS-MENU-OPTION-5
           DISPLAY WS-MENU-OPTION-6
           DISPLAY WS-MENU-OPTION-7
           DISPLAY WS-MENU-OPTION-8
           DISPLAY WS-MENU-OPTION-9
           DISPLAY WS-MENU-OPTION-0
           DISPLAY '========================================'.
       
       3200-GET-MENU-CHOICE.
           DISPLAY 'ENTER YOUR CHOICE (0-9): '
           ACCEPT WS-MENU-CHOICE.
       
       3300-PROCESS-MENU-CHOICE.
           EVALUATE WS-MENU-CHOICE
               WHEN 1 PERFORM 4000-CALL-PRODUCT-MANAGEMENT
               WHEN 2 PERFORM 4100-CALL-INVENTORY-CONTROL
               WHEN 3 PERFORM 4200-CALL-SUPPLIER-MANAGEMENT
               WHEN 4 PERFORM 4300-CALL-CUSTOMER-MANAGEMENT
               WHEN 5 PERFORM 4400-CALL-PURCHASE-ORDERS
               WHEN 6 PERFORM 4500-CALL-SALES-ORDERS
               WHEN 7 PERFORM 4600-CALL-WAREHOUSE-MANAGEMENT
               WHEN 8 PERFORM 4700-CALL-REPORTING-SYSTEM
               WHEN 9 PERFORM 4800-CALL-SYSTEM-ADMINISTRATION
               WHEN 0 PERFORM 4900-EXIT-SYSTEM
               WHEN OTHER PERFORM 4950-INVALID-MENU-CHOICE
           END-EVALUATE.
       
       4000-CALL-PRODUCT-MANAGEMENT.
           MOVE 'PRODUCT-MANAGEMENT' TO WS-MODULE-NAME
           PERFORM 4990-LOG-MODULE-ACCESS
           CALL WS-CALL-PRODUCT-MGMT
           PERFORM 4995-LOG-MODULE-EXIT.
       
       4100-CALL-INVENTORY-CONTROL.
           MOVE 'INVENTORY-CONTROL' TO WS-MODULE-NAME
           PERFORM 4990-LOG-MODULE-ACCESS
           CALL WS-CALL-INVENTORY
           PERFORM 4995-LOG-MODULE-EXIT.
       
       4200-CALL-SUPPLIER-MANAGEMENT.
           MOVE 'SUPPLIER-MANAGEMENT' TO WS-MODULE-NAME
           PERFORM 4990-LOG-MODULE-ACCESS
           CALL WS-CALL-SUPPLIER
           PERFORM 4995-LOG-MODULE-EXIT.
       
       4300-CALL-CUSTOMER-MANAGEMENT.
           MOVE 'CUSTOMER-MANAGEMENT' TO WS-MODULE-NAME
           PERFORM 4990-LOG-MODULE-ACCESS
           CALL WS-CALL-CUSTOMER
           PERFORM 4995-LOG-MODULE-EXIT.
       
       4400-CALL-PURCHASE-ORDERS.
           MOVE 'PURCHASE-ORDERS' TO WS-MODULE-NAME
           PERFORM 4990-LOG-MODULE-ACCESS
           CALL WS-CALL-PURCHASE
           PERFORM 4995-LOG-MODULE-EXIT.
       
       4500-CALL-SALES-ORDERS.
           MOVE 'SALES-ORDERS' TO WS-MODULE-NAME
           PERFORM 4990-LOG-MODULE-ACCESS
           CALL WS-CALL-SALES
           PERFORM 4995-LOG-MODULE-EXIT.
       
       4600-CALL-WAREHOUSE-MANAGEMENT.
           MOVE 'WAREHOUSE-MANAGEMENT' TO WS-MODULE-NAME
           PERFORM 4990-LOG-MODULE-ACCESS
           CALL WS-CALL-WAREHOUSE
           PERFORM 4995-LOG-MODULE-EXIT.
       
       4700-CALL-REPORTING-SYSTEM.
           MOVE 'REPORTING-SYSTEM' TO WS-MODULE-NAME
           PERFORM 4990-LOG-MODULE-ACCESS
           CALL WS-CALL-REPORTS
           PERFORM 4995-LOG-MODULE-EXIT.
       
       4800-CALL-SYSTEM-ADMINISTRATION.
           MOVE 'SYSTEM-ADMINISTRATION' TO WS-MODULE-NAME
           PERFORM 4990-LOG-MODULE-ACCESS
           CALL WS-CALL-ADMIN
           PERFORM 4995-LOG-MODULE-EXIT.
       
       4900-EXIT-SYSTEM.
           DISPLAY 'THANK YOU FOR USING THE SYSTEM'
           DISPLAY 'LOGGING OUT...'.
       
       4950-INVALID-MENU-CHOICE.
           DISPLAY 'INVALID CHOICE - PLEASE SELECT 0-9'.
       
       4990-LOG-MODULE-ACCESS.
           MOVE FUNCTION CURRENT-DATE TO AUDIT-TIMESTAMP
           MOVE WS-USER-ID TO AUDIT-USER-ID
           MOVE WS-MODULE-NAME TO AUDIT-MODULE
           MOVE 'MODULE-ACCESS' TO AUDIT-ACTION
           MOVE 'MODULE ACCESSED' TO AUDIT-DETAILS
           MOVE '192.168.1.100' TO AUDIT-IP-ADDRESS
           MOVE WS-SESSION-ID TO AUDIT-SESSION-ID
           WRITE AUDIT-RECORD.
       
       4995-LOG-MODULE-EXIT.
           MOVE FUNCTION CURRENT-DATE TO AUDIT-TIMESTAMP
           MOVE WS-USER-ID TO AUDIT-USER-ID
           MOVE WS-MODULE-NAME TO AUDIT-MODULE
           MOVE 'MODULE-EXIT' TO AUDIT-ACTION
           MOVE 'MODULE EXITED' TO AUDIT-DETAILS
           MOVE '192.168.1.100' TO AUDIT-IP-ADDRESS
           MOVE WS-SESSION-ID TO AUDIT-SESSION-ID
           WRITE AUDIT-RECORD.
       
       9000-SYSTEM-CLEANUP.
           PERFORM 9100-CLOSE-SYSTEM-FILES
           PERFORM 9200-LOG-SYSTEM-SHUTDOWN
           PERFORM 9300-DISPLAY-SHUTDOWN-MESSAGE.
       
       9100-CLOSE-SYSTEM-FILES.
           CLOSE SYSTEM-CONFIG
           CLOSE USER-SESSION
           CLOSE AUDIT-LOG
           CLOSE ERROR-LOG.
       
       9200-LOG-SYSTEM-SHUTDOWN.
           MOVE FUNCTION CURRENT-DATE TO AUDIT-TIMESTAMP
           MOVE WS-USER-ID TO AUDIT-USER-ID
           MOVE 'MAIN-SYSTEM' TO AUDIT-MODULE
           MOVE 'SYSTEM-SHUTDOWN' TO AUDIT-ACTION
           MOVE 'SYSTEM SHUTDOWN COMPLETE' TO AUDIT-DETAILS
           MOVE '192.168.1.100' TO AUDIT-IP-ADDRESS
           MOVE WS-SESSION-ID TO AUDIT-SESSION-ID
           WRITE AUDIT-RECORD.
       
       9300-DISPLAY-SHUTDOWN-MESSAGE.
           DISPLAY WS-MSG-SYSTEM-EXIT.
       
       9998-LOG-ERROR.
           MOVE FUNCTION CURRENT-DATE TO ERROR-TIMESTAMP
           MOVE WS-ERROR-SEVERITY TO ERROR-LEVEL
           MOVE WS-MODULE-NAME TO ERROR-MODULE
           MOVE WS-ERROR-CODE TO ERROR-CODE
           MOVE WS-ERROR-MESSAGE TO ERROR-MESSAGE
           MOVE SPACES TO ERROR-STACK-TRACE
           MOVE WS-USER-ID TO ERROR-USER-ID
           WRITE ERROR-RECORD
           ADD 1 TO WS-ERROR-COUNT.
       
       9999-SYSTEM-ERROR.
           MOVE 'FATAL' TO WS-ERROR-SEVERITY
           MOVE 'SYSTEM-FATAL' TO WS-ERROR-CODE
           MOVE 'FATAL SYSTEM ERROR - SHUTTING DOWN' TO WS-ERROR-MESSAGE
           MOVE 'SYSTEM-INITIALIZATION' TO WS-ERROR-LOCATION
           PERFORM 9998-LOG-ERROR
           PERFORM 9000-SYSTEM-CLEANUP
           STOP RUN.

